generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Usuario {
  id       Int    @id @default(autoincrement())
  email    String @unique
  password String
  rol      Rol    @default(DOCENTE)

  Bitacora         Bitacora[]
  DatosPersonales  DatosPersonales[]
  CedulaAutorizada CedulaAutorizada[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Bitacora {
  id      Int              @id @default(autoincrement())
  accion  String
  type    AccionesBitacora
  ip      String
  mensaje String?

  usuarioId Int
  usuario   Usuario @relation(fields: [usuarioId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model DatosPersonales {
  id              Int      @id @default(autoincrement())
  primerNombre    String
  segundoNombre   String?
  tercerNombre    String?
  primerApellido  String
  segundoApellido String?
  sexo            Sex
  fechaNacimiento DateTime
  numeroCedula    Int
  numeroBancario  String?
  telefono        String?

  usuarioId   Int          @unique
  usuario     Usuario      @relation(fields: [usuarioId], references: [id])
  direccionId Int?
  direccion   Direccion?   @relation(fields: [direccionId], references: [id])
  Expediente  Expediente[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Direccion {
  id         Int    @id @default(autoincrement())
  calle      String
  numeroCasa Int

  DatosPersonales    DatosPersonales[]
  zonaUrbanizacionId Int
  zonaUrbanizacion   ZonaUrbanizacion  @relation(fields: [zonaUrbanizacionId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ZonaUrbanizacion {
  id           Int      @id @default(autoincrement())
  codigoPostal Int
  zona         String
  vigencia     Vigencia @default(ACTIVO)

  estadoPaisId Int
  estadoPais   EstadoPais  @relation(fields: [estadoPaisId], references: [id])
  Direccion    Direccion[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model EstadoPais {
  id       Int      @id @default(autoincrement())
  estado   String   @unique
  vigencia Vigencia @default(ACTIVO)

  ZonaUrbanizacion ZonaUrbanizacion[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Expediente {
  id Int @id @default(autoincrement())

  datosPersonalesId Int
  datosPersonales   DatosPersonales @relation(fields: [datosPersonalesId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CedulaAutorizada {
  id       Int      @id @default(autoincrement())
  cedula   Int      @unique
  vigencia Vigencia @default(ACTIVO)

  usuarioId Int
  usuario   Usuario @relation(fields: [usuarioId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum AccionesBitacora {
  //Usuario
  LOGIN
  REGISTRO_USUARIO
  CHANGE_PASSWORD_EMAIL

  //estado
  REGISTRO_ESTADO
  ACTUALIZACION_ESTADO

  //zona
  REGISTRO_ZONA
  ACTUALIZACION_ZONA

  //micelanea
  ERROR
}

enum Rol {
  SUPER
  ADMIN
  AREA
  DOCENTE
}

enum Sex {
  HOMBRE
  MUJER
}

enum Vigencia {
  ACTIVO
  INACTIVO
}
